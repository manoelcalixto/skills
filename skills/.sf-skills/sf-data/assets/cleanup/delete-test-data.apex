/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * DELETE TEST DATA - COMPREHENSIVE CLEANUP
 * Remove all test data matching common test data patterns
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *
 * PURPOSE:
 * Clean up test data created by TestDataFactory classes.
 * Targets common test data naming patterns across multiple objects.
 *
 * PATTERNS MATCHED:
 * â€¢ 'Test%' - Standard test prefix
 * â€¢ 'BulkTest%' - Bulk testing data
 * â€¢ 'BatchTest%' - Batch Apex testing data
 * â€¢ 'BulkData%' - Large volume test data
 * â€¢ 'BulkImport%' - Import testing data
 * â€¢ 'Hierarchy%' - Hierarchy testing data
 * â€¢ '%@testfactory.example.com' - Test email domain
 * â€¢ '%@bulktest.example.com' - Bulk test email domain
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIGURATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Boolean previewOnly = true;     // Set to false to actually delete
Integer maxRecordsPerObject = 10000;

// Patterns to match (add your custom test patterns here)
List<String> namePatterns = new List<String>{
    'Test%',
    'BulkTest%',
    'BatchTest%',
    'BulkData%',
    'BulkImport%',
    'Hierarchy%'
};

List<String> emailPatterns = new List<String>{
    '%@testfactory.example.com',
    '%@bulktest.example.com',
    '%@batchtest.example.com'
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRACKING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Map<String, Integer> recordCounts = new Map<String, Integer>();

System.debug('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
System.debug('COMPREHENSIVE TEST DATA CLEANUP');
System.debug('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
System.debug('Mode: ' + (previewOnly ? 'PREVIEW ONLY' : 'âš ï¸  DELETE MODE'));
System.debug('Patterns: ' + namePatterns);
System.debug('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
System.debug('');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 1: FIND TASKS (delete first - activity records)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

List<Task> tasksToDelete = [
    SELECT Id, Subject, WhoId, WhatId
    FROM Task
    WHERE Subject LIKE 'Test%'
    OR Subject LIKE 'BulkTest%'
    OR Subject LIKE 'Hierarchy%'
    LIMIT :maxRecordsPerObject
];
recordCounts.put('Task', tasksToDelete.size());
System.debug('ğŸ“‹ Tasks found: ' + tasksToDelete.size());

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 2: FIND EVENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

List<Event> eventsToDelete = [
    SELECT Id, Subject, WhoId, WhatId
    FROM Event
    WHERE Subject LIKE 'Test%'
    OR Subject LIKE 'All Day Event%'
    OR Subject LIKE 'Recurring Event%'
    OR Subject LIKE 'Calendar Event%'
    LIMIT :maxRecordsPerObject
];
recordCounts.put('Event', eventsToDelete.size());
System.debug('ğŸ“‹ Events found: ' + eventsToDelete.size());

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 3: FIND CASES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

List<Case> casesToDelete = [
    SELECT Id, Subject, AccountId
    FROM Case
    WHERE Subject LIKE 'Test%'
    OR Subject LIKE 'Hierarchy Case%'
    LIMIT :maxRecordsPerObject
];
recordCounts.put('Case', casesToDelete.size());
System.debug('ğŸ“‹ Cases found: ' + casesToDelete.size());

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 4: FIND OPPORTUNITIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

List<Opportunity> opportunitiesToDelete = [
    SELECT Id, Name, AccountId
    FROM Opportunity
    WHERE Name LIKE 'Test%'
    OR Name LIKE 'BulkTest%'
    OR Name LIKE 'BatchTest%'
    OR Name LIKE 'Hierarchy%'
    LIMIT :maxRecordsPerObject
];
recordCounts.put('Opportunity', opportunitiesToDelete.size());
System.debug('ğŸ“‹ Opportunities found: ' + opportunitiesToDelete.size());

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 5: FIND CONTACTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

List<Contact> contactsToDelete = [
    SELECT Id, FirstName, LastName, Email, AccountId
    FROM Contact
    WHERE LastName LIKE 'Contact_%'
    OR LastName LIKE 'Hierarchy%'
    OR LastName LIKE 'Test%'
    OR Email LIKE '%@testfactory.example.com'
    OR Email LIKE '%@bulktest.example.com'
    OR Email LIKE '%@batchtest.example.com'
    LIMIT :maxRecordsPerObject
];
recordCounts.put('Contact', contactsToDelete.size());
System.debug('ğŸ“‹ Contacts found: ' + contactsToDelete.size());

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 6: FIND LEADS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

List<Lead> leadsToDelete = [
    SELECT Id, FirstName, LastName, Company
    FROM Lead
    WHERE LastName LIKE 'Lead%'
    OR LastName LIKE 'Test%'
    OR Company LIKE 'Test Company%'
    OR Email LIKE '%@testlead.example.com'
    LIMIT :maxRecordsPerObject
];
recordCounts.put('Lead', leadsToDelete.size());
System.debug('ğŸ“‹ Leads found: ' + leadsToDelete.size());

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 7: FIND ACCOUNTS (delete last - parent records)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

List<Account> accountsToDelete = [
    SELECT Id, Name
    FROM Account
    WHERE Name LIKE 'Test%'
    OR Name LIKE 'BulkTest%'
    OR Name LIKE 'BatchTest%'
    OR Name LIKE 'BulkData%'
    OR Name LIKE 'BulkImport%'
    OR Name LIKE 'Hierarchy%'
    OR Name LIKE 'Root Account%'
    OR Name LIKE 'Level%'
    LIMIT :maxRecordsPerObject
];
recordCounts.put('Account', accountsToDelete.size());
System.debug('ğŸ“‹ Accounts found: ' + accountsToDelete.size());

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUMMARY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Integer totalRecords = 0;
for (String objName : recordCounts.keySet()) {
    totalRecords += recordCounts.get(objName);
}

System.debug('');
System.debug('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
System.debug('CLEANUP SUMMARY');
System.debug('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
System.debug('  Tasks:         ' + recordCounts.get('Task'));
System.debug('  Events:        ' + recordCounts.get('Event'));
System.debug('  Cases:         ' + recordCounts.get('Case'));
System.debug('  Opportunities: ' + recordCounts.get('Opportunity'));
System.debug('  Contacts:      ' + recordCounts.get('Contact'));
System.debug('  Leads:         ' + recordCounts.get('Lead'));
System.debug('  Accounts:      ' + recordCounts.get('Account'));
System.debug('  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
System.debug('  TOTAL:         ' + totalRecords);
System.debug('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXECUTE DELETE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if (!previewOnly && totalRecords > 0) {
    System.debug('');
    System.debug('âš ï¸  DELETING RECORDS...');
    System.debug('   Deleting in dependency order (children before parents)');
    System.debug('');

    Integer deletedCount = 0;

    // Delete in order: Activities â†’ Children â†’ Parents
    try {
        if (!tasksToDelete.isEmpty()) {
            delete tasksToDelete;
            deletedCount += tasksToDelete.size();
            System.debug('  âœ“ Deleted ' + tasksToDelete.size() + ' Tasks');
        }

        if (!eventsToDelete.isEmpty()) {
            delete eventsToDelete;
            deletedCount += eventsToDelete.size();
            System.debug('  âœ“ Deleted ' + eventsToDelete.size() + ' Events');
        }

        if (!casesToDelete.isEmpty()) {
            delete casesToDelete;
            deletedCount += casesToDelete.size();
            System.debug('  âœ“ Deleted ' + casesToDelete.size() + ' Cases');
        }

        if (!opportunitiesToDelete.isEmpty()) {
            delete opportunitiesToDelete;
            deletedCount += opportunitiesToDelete.size();
            System.debug('  âœ“ Deleted ' + opportunitiesToDelete.size() + ' Opportunities');
        }

        if (!contactsToDelete.isEmpty()) {
            delete contactsToDelete;
            deletedCount += contactsToDelete.size();
            System.debug('  âœ“ Deleted ' + contactsToDelete.size() + ' Contacts');
        }

        if (!leadsToDelete.isEmpty()) {
            delete leadsToDelete;
            deletedCount += leadsToDelete.size();
            System.debug('  âœ“ Deleted ' + leadsToDelete.size() + ' Leads');
        }

        if (!accountsToDelete.isEmpty()) {
            delete accountsToDelete;
            deletedCount += accountsToDelete.size();
            System.debug('  âœ“ Deleted ' + accountsToDelete.size() + ' Accounts');
        }

        System.debug('');
        System.debug('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        System.debug('âœ… CLEANUP COMPLETE');
        System.debug('   Deleted: ' + deletedCount + ' records');
        System.debug('   Status: Moved to Recycle Bin');
        System.debug('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

    } catch (DmlException e) {
        System.debug('');
        System.debug('âŒ DELETE ERROR: ' + e.getMessage());
        System.debug('   Some records may have dependencies preventing deletion.');
        System.debug('   Try running again after resolving dependencies.');
    }
} else if (previewOnly) {
    System.debug('');
    System.debug('â„¹ï¸  PREVIEW MODE - No records deleted');
    System.debug('   To delete, set previewOnly = false and run again');
    System.debug('');
    System.debug('   âš ï¸  Please review the counts above before deleting!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BATCH APEX VERSION (For very large datasets)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/*
For datasets larger than 10,000 records, use batch Apex:

public class TestDataCleanupBatch implements Database.Batchable<SObject> {
    private String objectName;
    private String query;

    public TestDataCleanupBatch(String objName, String soqlQuery) {
        this.objectName = objName;
        this.query = soqlQuery;
    }

    public Database.QueryLocator start(Database.BatchableContext bc) {
        return Database.getQueryLocator(query);
    }

    public void execute(Database.BatchableContext bc, List<SObject> records) {
        delete records;
    }

    public void finish(Database.BatchableContext bc) {
        System.debug('Cleanup complete for ' + objectName);
    }
}

// Execute for each object (in order):
Database.executeBatch(new TestDataCleanupBatch('Task',
    'SELECT Id FROM Task WHERE Subject LIKE \'Test%\''), 200);
Database.executeBatch(new TestDataCleanupBatch('Account',
    'SELECT Id FROM Account WHERE Name LIKE \'Test%\''), 200);
*/
